## REMOVEME at v4.4
## = TRIGGERS shortdocu = ##
#
## = ADDED = ##
# trader_is_subterranean
# is_psionic_aura_suppressed
# country_has_habitability_and_housing
# planet_has_habitability_and_housing
# wrangler_is_animal_handler_trigger
# wrangler_is_beastfighter_trigger
# wrangler_is_hunter_drone_trigger
# wrangler_is_rancher_trigger
# wrangler_is_symbiosis_integrator_trigger
# wrangler_is_trophy_hunter_trigger
#
## = REMOVED 12 = ##
# can_assemble_bio_pop
# can_assemble_hive_pop
# can_assemble_robot
# check_aura_suppressors
# has_any_habitability_and_housing
# has_decent_habitability
# has_decent_habitability_and_housing
# has_good_habitability
# has_good_habitability_and_housing
# has_some_habitability
# has_some_habitability_and_housing
# miner_is_mineral_diver_trigger
##

trader_is_subterranean = {
	optimize_memory
	exists = planet
	planet = {
		has_deposit = d_underground_contact_zone
	}
}

is_psionic_aura_suppressed = {
	optimize_memory
	OR = {
		check_aura_suppression_buildings = yes
		any_system_colony = {
			has_owner = yes
			OR = {
				AND = {
					has_active_building = building_psionic_suppressor
					owner = {
						has_resource = { type = sr_zro amount > 0 }
					}
				}
				has_active_building = building_ancient_ward_2
			}
		}
		has_megastructure = shroud_seal
		check_variable_arithmetic = { which = value:count_neighbor_shroud_seals value > 0 }
	}
}

# 01_scripted_triggers_refugees.txt
country_has_habitability_and_housing = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		planet_has_habitability_and_housing = {
			[[HABITABILITY]
			HABITABILITY = $HABITABILITY$
			]
			[[HOUSING]
			HOUSING = $HOUSING$
			]
		}
	}
}

planet_has_habitability_and_housing = {
	optimize_memory
	[[HABITABILITY]

	habitability = {
		who = event_target:refugee_pop
		value >= $HABITABILITY$
	}

	]
	[[HOUSING]
	free_housing >= $HOUSING$
	]
	NOR = { # Vfix opt
		is_occupied_flag = yes
		is_under_colonization = yes
		has_orbital_bombardment = yes
		is_planet_class = pc_cosmogenesis_world
	}
}

is_gestalt_ruler = {
	optimize_memory
	OR = {
		is_councilor_type = councilor_ruler_hive_mind
		is_councilor_type = councilor_ruler_machine_intelligence
	}
}

is_toxic_baths_empire = {
	optimize_memory
	OR = {
		has_valid_civic = civic_toxic_baths
		has_valid_civic = civic_corporate_toxic_baths
		has_valid_civic = civic_hive_toxic_baths
		has_valid_civic = civic_machine_toxic_baths
		has_valid_civic = civic_toxic_baths_individual_machine
		has_valid_civic = civic_corporate_toxic_baths_individual_machine
	}
}

has_toxic_baths_building = {
	optimize_memory
	OR = {
		has_active_building = building_toxic_bath
		has_active_building = building_toxic_bath_hive
		has_active_building = building_toxic_bath_machine
	}
}

has_anti_psionic_assimilation_living_standard = {
	optimize_memory
	has_living_standard = {
		type = living_standard_shroud_inoculation
		country = $COUNTRY$
	}
}

### REMOVED at v4.3 ###
# 05_scripted_triggers_traits.txt
can_assemble_bio_pop = {
	optimize_memory
	planet = {
		NAND = {
			exists = assembling_species
			assembling_species = { is_robotic = yes }
		}
	}
}

can_assemble_hive_pop = {
	optimize_memory
	planet = {
		OR = {
			NOT = { exists = assembling_species }
			assembling_species = {
				OR = {
					has_trait = trait_hive_mind
					is_robotic = yes
				}
			}
		}
	}
}

can_assemble_robot = {
	optimize_memory
	planet = {
		OR = {
			NOT = { exists = assembling_species }
			assembling_species = { is_robotic = yes }
		}
	}
}

has_toxic_baths = {
	is_toxic_baths_empire = yes
}

# 08_scripted_triggers_shroud.txt
# scope = system
check_aura_suppressors = {
	optimize_memory
	OR = {
		check_aura_suppression_buildings = yes
		check_variable_arithmetic = { which = value:count_neighbor_shroud_seals value > 0 }
	}
}

# 01_scripted_triggers_jobs.txt
miner_is_mineral_diver_trigger = {
	optimize_memory
	has_deposit = d_mineral_seabed
}

# 01_scripted_triggers_refugees.txt
### TODO REMOVEME in v4.4 (Old v4.2 triggers)

has_good_habitability_and_housing = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.7 }
		free_housing >= 100
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_good_habitability = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.7 }
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_decent_habitability_and_housing = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.5 }
		free_housing >= 100
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_decent_habitability = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.5 }
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_some_habitability_and_housing = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.2 }
		free_housing >= 100
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_some_habitability = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		habitability = { who = event_target:refugee_pop value >= 0.2 }
		is_under_colonization = no
		is_occupied_flag = no
		has_orbital_bombardment = no
	}
}

has_any_habitability_and_housing = {
	optimize_memory
	has_country_flag = valid_refugee_destination_for_@event_target:refugee_pop

	any_owned_planet = {
		NOR = {
			free_housing < 100
			is_under_colonization = yes
			is_occupied_flag = yes
			has_orbital_bombardment = yes
			is_planet_class = pc_cosmogenesis_world
		}
	}
}

roboticist_is_bath_attendant_individual_machine = {
	optimize_memory
	has_active_building = building_toxic_bath_machine
}

replicator_is_bath_attendant_machine = {
	optimize_memory
	has_active_building = building_toxic_bath_machine
}

spawning_drone_is_bath_attendant_hive_trigger = {
	optimize_memory
	has_active_building = building_toxic_bath_hive
}
